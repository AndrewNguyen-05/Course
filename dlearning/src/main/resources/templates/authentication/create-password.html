<!DOCTYPE html>
<html lang="en">
<head th:replace="~{layout/head :: head}">
    <title>Create Password</title>
</head>
<body>
<div class="container-fluid bg-dark">
    <div class="row py-2 px-lg-5">
        <div class="col-lg-6 text-center text-lg-left mb-2 mb-lg-0">
            <div class="d-inline-flex align-items-center text-white">
                <small><i class="fa fa-phone-alt mr-2"></i>+012 345 6789</small>
                <small class="px-3">|</small>
                <small><i class="fa fa-envelope mr-2"></i>info@example.com</small>
            </div>
        </div>
        <div class="col-lg-6 text-center text-lg-right">
            <div class="d-inline-flex align-items-center">
                <a class="text-white px-2" href="">
                    <i class="fab fa-facebook-f"></i>
                </a>
                <a class="text-white px-2" href="">
                    <i class="fab fa-twitter"></i>
                </a>
                <a class="text-white px-2" href="">
                    <i class="fab fa-linkedin-in"></i>
                </a>
                <a class="text-white px-2" href="">
                    <i class="fab fa-instagram"></i>
                </a>
                <a class="text-white pl-2" href="">
                    <i class="fab fa-youtube"></i>
                </a>
            </div>
        </div>
    </div>
</div>
<!-- Topbar End -->

<!-- Navbar Start -->
<div class="container-fluid p-0">
    <nav class="navbar navbar-expand-lg bg-white navbar-light py-3 py-lg-0 px-lg-5">
        <a th:href="@{/home}" class="navbar-brand ml-lg-3">
            <h1 class="m-0 text-uppercase text-primary rounded">
                <i class="fa fa-book-reader mr-3"></i>Edukate
            </h1>
        </a>
        <button type="button" class="navbar-toggler rounded" data-bs-toggle="collapse" data-bs-target="#navbarCollapse">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse justify-content-between px-lg-3" id="navbarCollapse">
            <div class="navbar-nav mx-auto py-0">
                <a th:href="@{/home}" class="nav-item nav-link active rounded">Home</a>
                <a th:href="@{/about}" class="nav-item nav-link rounded">About</a>
                <a th:href="@{/courses}" class="nav-item nav-link rounded">Courses</a>
                <div class="nav-item dropdown rounded">
                    <a href="#" class="nav-link dropdown-toggle rounded" data-bs-toggle="dropdown">Pages</a>
                    <div class="dropdown-menu m-0 rounded">
                        <a th:href="@{/course-detail}" class="dropdown-item rounded">Course Detail</a>
                        <a th:href="@{/our-feature}" class="dropdown-item rounded">Our Features</a>
                        <a th:href="@{/instructor}" class="dropdown-item rounded">Instructors</a>
                        <a th:href="@{/testimonial}" class="dropdown-item rounded">Testimonial</a>
                    </div>
                </div>
                <a th:href="@{/contact}" class="nav-item nav-link rounded">Contact</a>
            </div>
            <div class="nav-item dropdown">
                <a href="#" class="btn btn-primary rounded-circle d-flex align-items-center justify-content-center"
                   style="width: 50px; height: 50px;" data-bs-toggle="dropdown" aria-expanded="false">
                    <i class="fa-solid fa-user-graduate"></i>
                </a>
                <ul class="dropdown-menu dropdown-menu-end text-start" style="transform: translateX(-50%); left: 50%;">
                    <li><a th:href="@{/profile}" class="dropdown-item d-flex align-items-center">
                        <i class="fa-solid fa-address-card me-2"></i>Profile</a></li>
                    <li><a href="deposit.html" class="dropdown-item d-flex align-items-center">
                        <i class="fa-brands fa-bitcoin me-2"></i>Deposit</a></li>
                    <li><a href="change-password.html" class="dropdown-item d-flex align-items-center">
                        <i class="fa-solid fa-key me-2"></i>Password</a></li>
                    <li><a th:href="@{/login}" class="dropdown-item d-flex align-items-center">
                        <i class="fa-solid fa-sign-in-alt me-2"></i>Login</a></li>
                    <li><a th:href="@{/login}" class="dropdown-item d-flex align-items-center" id="logout">
                        <i class="fa-solid fa-sign-out-alt me-2"></i>Logout</a></li>
                </ul>
            </div>
        </div>
    </nav>
</div>
<hr>

<div class="container d-flex justify-content-center">
    <div class="card p-4 shadow-lg" style="max-width: 500px; width: 100%; margin-top: 50px">
        <div class="card-body text-center">
            <div class="mb-4">
                <i class="bi bi-shield-lock-fill" style="font-size: 3rem; color: #007bff;"></i>
                <h2 class="card-title mt-3">Create Your Password</h2>
            </div>
            <form id="create-password">

                <div class="form-floating mb-3">
                    <input type="password" class="form-control" id="password" placeholder="Password">
                    <label for="password"><i class="bi bi-lock-fill me-2"></i>Password</label>
                    <div id="passwordError" class="text-danger mt-1" style="display: none;"></div> <!-- Thông báo lỗi mật khẩu -->
                </div>

                <button type="submit" class="btn btn-primary w-100 btn-lg">Create Password</button>
            </form>
        </div>
    </div>
</div>

<div th:replace="~{layout/footer :: footer}"></div>

<!-- Bootstrap 5 JS Bundle with Popper -->
<script src="/js/logout.js"></script>

<script>
    $(document).ready(function() {

        $('#create-password').submit(function(event) {
            event.preventDefault();

            let password = $('#password').val();


            $('#passwordError').hide();

            let hasError = false;
            if (password.length < 6) {
                $('#passwordError').text("Mật khẩu phải có ít nhất 6 ký tự").show();
                hasError = true;
            }
            if (!hasError) {
                let data = {
                    password: password,
                };

                let token = localStorage.getItem('token')
                fetch(`http://localhost:8080/api/v1/create-password`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`,
                    },
                    body: JSON.stringify(data)
                }).then((response) => {
                    if (!response.ok) {
                        return response.json().then((errorData) => {
                            throw Error(errorData.message);
                        });
                    }
                    return response.json();
                }).then((data) => {
                    alert(data.message || 'Mật khẩu đã được tạo thành công!');
                    window.location.href = '/home';
                }).catch(error => {
                    // Hiển thị thông báo lỗi từ backend
                    if (error.message.includes("INVALID_PASSWORD")) {
                        $('#passwordError').text(error.message).show();
                    } else {
                        alert(error.message);
                    }
                });
            }
        });

    });
</script>
</body>
</html>
